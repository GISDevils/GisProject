<!DOCTYPE html>
<html> 
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    	<style type="text/css">
      		html { height: 100% }
      		body { height: 100%; margin: 0; padding: 0 }
      		#map-canvas { height: 100%; width: 70%; margin-top: 60; }
          #panel 
          {
            position: absolute;
            top: 5px;
            left: 40%;
            margin-left: -180px;
            z-index: 5;
            background-color: #fff;
            padding: 5px;
            border: 1px solid #999;
          }
          #side
          {
            position: absolute;
            top: 10px;
            left: 70%;
            margin-left: 10px;
            font-family:Monospace;
            width: 30%;
          }
    	</style>
    	<script type="text/javascript"
      		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjNmXUhHhcG-Zh2SZ6fWn0uyIWBByJSXY&libraries=drawing&sensor=true">
    	</script>
    	<script type="text/javascript">

          var initialLocation;

          var neighborhoods = 
          [
            new google.maps.LatLng(52.511467, 13.447179),
            new google.maps.LatLng(52.549061, 13.422975),
            new google.maps.LatLng(52.497622, 13.396110),
            new google.maps.LatLng(52.517683, 13.394393)
          ];

          var markers = [];
          var iterator = 0;

          var map;

      		function initialize() 
          {
            document.getElementById('side').innerHTML = "Nothing is found yet";
            initialLocation = new google.maps.LatLng(52.520816, 13.410186);

        	   var mapOptions = 
             {
          		center: new google.maps.LatLng(52.520816, 13.410186),
          		zoom: 13,
              mapTypeId: google.maps.MapTypeId.TERRAIN
        	   };
        	   map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

             //Initialize drawing library
             //var drawingManager = new google.maps.drawing.DrawingManager(
                //drawingControl: false
              //{
              //});
             //drawingManager.setMap(map);

             if(navigator.geolocation) 
             {
                navigator.geolocation.getCurrentPosition(function(position) {
                    initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    map.setCenter(initialLocation);

                    var infoWindow = new google.maps.InfoWindow({
                      map: map,
                      position: initialLocation,
                      content: "Your location"
                    });
                  }, function() {
                    initialLocation = new google.maps.LatLng(52.520816, 13.410186);
                    alert("Geolocation service failed");
                  });
      		   }
           }

          function drop() 
          {
            for (var i = 0; i < neighborhoods.length; i++) 
            {
              setTimeout(function() 
              {
                addMarker();
              }, i * 200);
            }
          }

          function addMarker(latitude, longitude) 
          {
            markers.push(new google.maps.Marker({
              position: new google.maps.LatLng(latitude, longitude),
              map: map,
              draggable: false,
              animation: google.maps.Animation.DROP
              }));
          }

          function setAllMap(map)
          {
            for (var i = 0; i < markers.length; i++)
              markers[i].setMap(map);
          }

          function clearMarkers()
          {
            setAllMap(null);
          }

          function showMarkers()
          {
            setAllMap(map);
          }

          function deleteMarkers()
          {
            clearMarkers();
            markers = [];
          }

          var httpHandler = function(responseJson)
          {
            var obj = JSON.parse(responseJson);
            //alert(obj.count);
            for (var i = 0; i < obj.count; i++)
            {
              addMarker(latitude, longitude);
            }

            document.getElementById('side').innerHTML = "Our service found cafes matching your criteria:";
          };

          //client-server interaction
          function sendHttpRequest(url, success, failure)
          {
            //var request = makeHttpObject();
            var request = new XMLHttpRequest();
            request.open("GET", url, true);
            request.send(null);
            request.onreadystatechange = function() {
              if (request.readyState == 4)
              {
                if (request.status == 200)
                  success(request.responseText);
                else if (failure)
                  failure (request.status, request.statusText);
              }
            };
          };

          function submit()
          {
            var price = document.getElementById('price').value;
            var distance = document.getElementById('distance').value;
            var cuisine = document.getElementById('cuisine').value;
            var type = document.getElementById('type').value;

            //sendHttpRequest("http://django-vmigisdevils.rhcloud.com/cafe/api/addresses/?price=" + price + "&distance=" + distance + "&latitude=" + initialLocation.latitude + "&longitude=" + initialLocation.longitude + "&cuisine=" + cuisine, httpHandler);
            sendHttpRequest("http://django-vmigisdevils.rhcloud.com/cafe/api/addresses/?max_price=" + price + "&distance=" + distance + "&latitude=" + initialLocation.latitude + "&longitude=" + initialLocation.longitude, httpHandler);
          };

      		google.maps.event.addDomListener(window, 'load', initialize);

    	</script>
	</head>
	<body>
	<!--
	<iframe
 		width="450"
 		height="250"
 		frameborder="0" style="border:0"
 		src="https://www.google.com/maps/embed/v1/search?key=AIzaSyBjNmXUhHhcG-	Zh2SZ6fWn0uyIWBByJSXY&q=record+stores+in+Seattle">
		</iframe>
		-->
    <div id="panel" style="margin-left: -52px">
      <form id="data form">
        <b>Price:   </b>
        <input id="price" type="text">
        <b>Distance:</b>
        <input id="distance" type="text">
        <br />
        <b>Cuisine: </b>
        <input id="cuisine" type="text">
        <b>Type:    </b>
        <input id="type" type="text">
        <!--<input type="submit" onclick="submit()"> -->
        <!--<select id="start" onchange="calcRoute();">
          <option value="current location">Current Location</option>
        </select> -->
      </form>
      <button id="sendRequest" onclick="submit()">Search for Cafe</button>
      <!--<button id="drop" onclick="drop()">Search Cafe</button>
      <button id="remap" onclick="remap()">Remap</button> -->
    </div>
    <div id="side"></div>
		<div id="map-canvas"/>
	</body>
</html>